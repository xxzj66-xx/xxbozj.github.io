<html lang="zh-CN"><head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>嘻嘻社工</title> 
  <style>
        :root {
            --primary-color: #1e88e5;
            --secondary-color: #546e7a;
            --dark-color: #263238;
            --light-color: #f5f5f5;
            --success-color: #4CAF50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 50%, #80deea 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(to right, #00b4db, #0083b0);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .upload-area {
            width: 100%;
            border: 2px dashed #b0bec5;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            background-color: #f5f5f5;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
            background-color: rgba(30, 136, 229, 0.05);
        }
        
        .upload-area i {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .upload-area h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--dark-color);
        }
        
        .upload-area p {
            color: var(--secondary-color);
            font-size: 14px;
        }
        
        #file-input, #watermark-image-input {
            display: none;
        }
        
        .preview-container {
            width: 100%;
            margin-top: 20px;
            display: none;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: block;
            margin: 0 auto;
        }
        
        .controls {
            width: 100%;
            margin-top: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .control-panel {
            flex: 1;
            min-width: 300px;
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
        }
        
        .control-panel h3 {
            margin-bottom: 15px;
            color: var(--dark-color);
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .control-group input, 
        .control-group select,
        .control-group textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #b0bec5;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .control-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .radio-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
        }
        
        .radio-option input {
            margin-right: 5px;
        }
        
        .btn {
            padding: 12px 25px;
            background: linear-gradient(to right, #00b4db, #0083b0);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-download {
            background: linear-gradient(to right, #4CAF50, #2E7D32);
            margin-left: 15px;
        }
        
        .btn-secondary {
            background: linear-gradient(to right, #78909c, #546e7a);
        }
        
        .canvas-container {
            position: relative;
            margin: 0 auto;
            display: none;
        }
        
        #image-canvas {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .loading {
            display: none;
            margin: 20px 0;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 180, 219, 0.2);
            border-top: 4px solid #00b4db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .watermark-preview {
            max-width: 100px;
            max-height: 100px;
            margin-top: 10px;
            display: none;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .btn-group {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            .control-panel {
                min-width: 100%;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                margin-left: 0;
                margin-top: 10px;
            }
        }
    </style> 
 </head> 
 <body id="v1"> 
  <div id="v2" class="container"> 
   <div id="v3" class="header"> 
    <h1 id="v4">嘻嘻社工</h1> 
    <p id="v5">支持自定义文字水印和图片水印</p> 
    <p style="font-size:12px;margin-top:5px;">本软件仅供学习，请勿用于违法犯罪</p>
   </div> 
   <div id="v6" class="content"> 
    <div class="upload-area" id="upload-area"> 
     <i id="v7" class="fas fa-cloud-upload-alt"></i> 
     <h3 id="v8">点击或拖放图片到此处</h3> 
     <p id="v9">支持 JPG, PNG 格式的图片</p> 
     <input type="file" id="file-input" accept="image/*"> 
    </div> 
    <div class="preview-container" id="preview-container"> 
     <img id="image-preview" class="image-preview" alt="预览图片"> 
    </div> 
    <div class="canvas-container" id="canvas-container"> 
     <canvas id="image-canvas"></canvas> 
    </div> 
    <div class="loading" id="loading"> 
     <div id="v10" class="loading-spinner"></div> 
    </div> 
    <div id="v11" class="controls"> 
     <div id="v12" class="control-panel"> 
      <h3 id="v13">文字水印设置</h3> 
      <div id="v14" class="control-group"> 
       <label id="v15" for="text-content">文字内容</label> 
       <textarea id="text-content" placeholder="输入水印文字，例如：大海">大海</textarea> 
      </div> 
      <div id="v16" class="control-group"> 
       <label id="v17" for="text-font">字体</label> 
       <select id="text-font"> <option id="v18" value="Arial">Arial</option> <option id="v19" value="Microsoft YaHei" selected="">微软雅黑</option> <option id="v20" value="SimSun">宋体</option> <option id="v21" value="KaiTi">楷体</option> <option id="v22" value="Courier New">Courier New</option> </select> 
      </div> 
      <div id="v23" class="control-group"> 
       <label id="v24" for="text-size">文字大小</label> 
       <input type="number" id="text-size" min="10" max="100" value="30"> 
      </div> 
      <div id="v25" class="control-group"> 
       <label id="v26" for="text-color">文字颜色</label> 
       <input type="color" id="text-color" value="#1e88e5"> 
      </div> 
      <div id="v27" class="control-group"> 
       <label id="v28" for="text-opacity">透明度 (0-1)</label> 
       <input type="number" id="text-opacity" min="0" max="1" step="0.1" value="0.8"> 
      </div> 
      <div id="v29" class="control-group"> 
       <label id="v30" for="text-angle">旋转角度 (0-360)</label> 
       <input type="number" id="text-angle" min="0" max="360" value="0"> 
      </div> 
      <div id="v31" class="control-group"> 
       <label id="v32" for="text-position">文字位置</label> 
       <select id="text-position"> <option id="v33" value="center">居中</option> <option id="v34" value="top-right">右上角</option> <option id="v35" value="bottom-right">右下角</option> <option id="v36" value="top-left">左上角</option> <option id="v37" value="bottom-left">左下角</option> <option id="v38" value="tile">平铺</option> </select> 
      </div> 
     </div> 
     <div id="v39" class="control-panel"> 
      <h3 id="v40">图片水印设置</h3> 
      <div id="v41" class="radio-group"> 
       <div id="v42" class="radio-option"> 
        <input type="radio" id="watermark-type-text" name="watermark-type" value="text" checked=""> 
        <label id="v43" for="watermark-type-text">文字水印</label> 
       </div> 
       <div id="v44" class="radio-option"> 
        <input type="radio" id="watermark-type-image" name="watermark-type" value="image"> 
        <label id="v45" for="watermark-type-image">图片水印</label> 
       </div> 
      </div> 
      <div id="image-watermark-controls" style="display: none;"> 
       <div id="v46" class="control-group"> 
        <label id="v47" for="watermark-image-input">选择水印图片</label> 
        <button class="btn btn-secondary" id="select-watermark-btn" style="width: 100%; margin-top: 0;">选择图片</button> 
        <input type="file" id="watermark-image-input" accept="image/*"> 
        <img id="watermark-preview" class="watermark-preview" alt="水印图片预览"> 
       </div> 
       <div id="v48" class="control-group"> 
        <label id="v49" for="watermark-opacity">透明度 (0-1)</label> 
        <input type="number" id="watermark-opacity" min="0" max="1" step="0.1" value="0.5"> 
       </div> 
       <div id="v50" class="control-group"> 
        <label id="v51" for="watermark-scale">缩放比例 (0.1-1)</label> 
        <input type="number" id="watermark-scale" min="0.1" max="1" step="0.1" value="0.3"> 
       </div> 
       <div id="v52" class="control-group"> 
        <label id="v53" for="watermark-angle">旋转角度 (0-360)</label> 
        <input type="number" id="watermark-angle" min="0" max="360" value="0"> 
       </div> 
       <div id="v54" class="control-group"> 
        <label id="v55" for="watermark-position">水印位置</label> 
        <select id="watermark-position"> <option id="v56" value="center">居中</option> <option id="v57" value="top-right">右上角</option> <option id="v58" value="bottom-right">右下角</option> <option id="v59" value="top-left">左上角</option> <option id="v60" value="bottom-left">左下角</option> <option id="v61" value="tile">平铺</option> </select> 
       </div> 
      </div> 
     </div> 
    </div> 
    <div id="v62" class="btn-group"> 
     <button class="btn" id="add-watermark-btn">添加水印</button> 
     <button class="btn btn-download" id="download-btn">下载图片</button> 
    </div> 
   </div> 
  </div> 
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script> 
  <script src="js/jq.js"></script> 
  <script>
        // 获取DOM元素
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const previewContainer = document.getElementById('preview-container');
        const imagePreview = document.getElementById('image-preview');
        const canvasContainer = document.getElementById('canvas-container');
        const canvas = document.getElementById('image-canvas');
        const ctx = canvas.getContext('2d');
        const loading = document.getElementById('loading');
        const addWatermarkBtn = document.getElementById('add-watermark-btn');
        const downloadBtn = document.getElementById('download-btn');
        
        // 水印类型选择
        const watermarkTypeText = document.getElementById('watermark-type-text');
        const watermarkTypeImage = document.getElementById('watermark-type-image');
        const imageWatermarkControls = document.getElementById('image-watermark-controls');
        
        // 文字水印控制元素
        const textContent = document.getElementById('text-content');
        const textFont = document.getElementById('text-font');
        const textSize = document.getElementById('text-size');
        const textColor = document.getElementById('text-color');
        const textOpacity = document.getElementById('text-opacity');
        const textAngle = document.getElementById('text-angle');
        const textPosition = document.getElementById('text-position');
        
        // 图片水印控制元素
        const selectWatermarkBtn = document.getElementById('select-watermark-btn');
        const watermarkImageInput = document.getElementById('watermark-image-input');
        const watermarkPreview = document.getElementById('watermark-preview');
        const watermarkOpacity = document.getElementById('watermark-opacity');
        const watermarkScale = document.getElementById('watermark-scale');
        const watermarkAngle = document.getElementById('watermark-angle');
        const watermarkPosition = document.getElementById('watermark-position');
        
        // 当前图片和水印图片
        let currentImage = null;
        let watermarkImage = null;
        
        // 水印类型切换
        watermarkTypeText.addEventListener('change', () => {
            imageWatermarkControls.style.display = 'none';
        });
        
        watermarkTypeImage.addEventListener('change', () => {
            imageWatermarkControls.style.display = 'block';
        });
        
        // 上传区域点击事件
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        // 选择水印图片按钮
        selectWatermarkBtn.addEventListener('click', () => {
            watermarkImageInput.click();
        });
        
        // 文件选择事件
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                loadImage(file);
            }
        });
        
        // 水印图片选择事件
        watermarkImageInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        watermarkImage = img;
                        watermarkPreview.src = e.target.result;
                        watermarkPreview.style.display = 'block';
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
        
        // 拖放功能
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#1e88e5';
            uploadArea.style.backgroundColor = 'rgba(30, 136, 229, 0.1)';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#b0bec5';
            uploadArea.style.backgroundColor = '#f5f5f5';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#b0bec5';
            uploadArea.style.backgroundColor = '#f5f5f5';
            
            if (e.dataTransfer.files.length > 0) {
                const file = e.dataTransfer.files[0];
                if (file.type.match('image.*')) {
                    loadImage(file);
                } else {
                    alert('请选择图片文件');
                }
            }
        });
        
        // 加载图片
        function loadImage(file) {
            loading.style.display = 'block';
            previewContainer.style.display = 'none';
            canvasContainer.style.display = 'none';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    currentImage = img;
                    imagePreview.src = e.target.result;
                    previewContainer.style.display = 'block';
                    loading.style.display = 'none';
                    
                    // 初始化canvas
                    initCanvas(img);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // 初始化Canvas
        function initCanvas(img) {
            canvas.width = img.width;
            canvas.height = img.height;
            
            // 绘制原始图片
            ctx.drawImage(img, 0, 0);
            
            // 显示Canvas
            canvasContainer.style.display = 'block';
        }
        
        // 添加水印
        addWatermarkBtn.addEventListener('click', () => {
            if (!currentImage) {
                alert('请先上传图片');
                return;
            }
            
            // 清除Canvas并重新绘制原始图片
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(currentImage, 0, 0);
            
            // 检查水印类型
            const isTextWatermark = document.querySelector('input[name="watermark-type"]:checked').value === 'text';
            
            if (isTextWatermark) {
                addTextWatermark();
            } else {
                if (!watermarkImage) {
                    alert('请先上传水印图片');
                    return;
                }
                addImageWatermark();
            }
        });
        
        // 添加文字水印
        function addTextWatermark() {
            // 设置文字样式
            const font = textFont.value;
            const size = parseInt(textSize.value);
            const color = textColor.value;
            const opacity = parseFloat(textOpacity.value);
            const angle = parseInt(textAngle.value);
            const text = textContent.value;
            const position = textPosition.value;
            
            ctx.font = `bold ${size}px ${font}`;
            ctx.fillStyle = color;
            ctx.globalAlpha = opacity;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // 添加文字阴影效果
            ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
            ctx.shadowBlur = 5;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            
            if (position === 'tile') {
                // 平铺水印
                const textWidth = ctx.measureText(text).width;
                const spacingX = textWidth * 1.5;
                const spacingY = size * 2;
                
                // 保存当前状态
                ctx.save();
                
                // 设置旋转中心为画布中心
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate(angle * Math.PI / 180);
                
                // 计算平铺起始点
                const startX = -canvas.width;
                const startY = -canvas.height;
                
                // 绘制平铺水印
                for (let x = startX; x < canvas.width * 2; x += spacingX) {
                    for (let y = startY; y < canvas.height * 2; y += spacingY) {
                        ctx.fillText(text, x, y);
                    }
                }
                
                // 恢复状态
                ctx.restore();
            } else {
                // 单水印
                let x, y;
                const padding = 20;
                
                switch(position) {
                    case 'center':
                        x = canvas.width / 2;
                        y = canvas.height / 2;
                        break;
                    case 'top-right':
                        x = canvas.width - padding;
                        y = padding + size/2;
                        ctx.textAlign = 'right';
                        break;
                    case 'bottom-right':
                        x = canvas.width - padding;
                        y = canvas.height - padding - size/2;
                        ctx.textAlign = 'right';
                        break;
                    case 'top-left':
                        x = padding;
                        y = padding + size/2;
                        ctx.textAlign = 'left';
                        break;
                    case 'bottom-left':
                        x = padding;
                        y = canvas.height - padding - size/2;
                        ctx.textAlign = 'left';
                        break;
                }
                
                // 保存当前状态
                ctx.save();
                
                // 设置旋转中心为水印位置
                ctx.translate(x, y);
                ctx.rotate(angle * Math.PI / 180);
                
                // 绘制文字（在旋转后的坐标系中，位置为0,0）
                ctx.fillText(text, 0, 0);
                
                // 恢复状态
                ctx.restore();
            }
            
            // 重置阴影和透明度
            ctx.shadowColor = 'transparent';
            ctx.globalAlpha = 1.0;
        }
        
        // 添加图片水印
        function addImageWatermark() {
            const opacity = parseFloat(watermarkOpacity.value);
            const scale = parseFloat(watermarkScale.value);
            const angle = parseInt(watermarkAngle.value);
            const position = watermarkPosition.value;
            
            // 计算缩放后的水印尺寸
            const scaledWidth = watermarkImage.width * scale;
            const scaledHeight = watermarkImage.height * scale;
            
            ctx.globalAlpha = opacity;
            
            if (position === 'tile') {
                // 平铺水印
                const spacingX = scaledWidth * 1.2;
                const spacingY = scaledHeight * 1.2;
                
                // 保存当前状态
                ctx.save();
                
                // 设置旋转中心为画布中心
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate(angle * Math.PI / 180);
                
                // 计算平铺起始点
                const startX = -canvas.width;
                const startY = -canvas.height;
                
                // 绘制平铺水印
                for (let x = startX; x < canvas.width * 2; x += spacingX) {
                    for (let y = startY; y < canvas.height * 2; y += spacingY) {
                        ctx.drawImage(watermarkImage, x - scaledWidth/2, y - scaledHeight/2, scaledWidth, scaledHeight);
                    }
                }
                
                // 恢复状态
                ctx.restore();
            } else {
                // 单水印
                let x, y;
                const padding = 20;
                
                switch(position) {
                    case 'center':
                        x = canvas.width / 2;
                        y = canvas.height / 2;
                        break;
                    case 'top-right':
                        x = canvas.width - padding - scaledWidth/2;
                        y = padding + scaledHeight/2;
                        break;
                    case 'bottom-right':
                        x = canvas.width - padding - scaledWidth/2;
                        y = canvas.height - padding - scaledHeight/2;
                        break;
                    case 'top-left':
                        x = padding + scaledWidth/2;
                        y = padding + scaledHeight/2;
                        break;
                    case 'bottom-left':
                        x = padding + scaledWidth/2;
                        y = canvas.height - padding - scaledHeight/2;
                        break;
                }
                
                // 保存当前状态
                ctx.save();
                
                // 设置旋转中心为水印位置
                ctx.translate(x, y);
                ctx.rotate(angle * Math.PI / 180);
                
                // 绘制水印图片（在旋转后的坐标系中，中心为0,0）
                ctx.drawImage(watermarkImage, -scaledWidth/2, -scaledHeight/2, scaledWidth, scaledHeight);
                
                // 恢复状态
                ctx.restore();
            }
            
            // 重置透明度
            ctx.globalAlpha = 1.0;
        }
        
        // 下载图片
     downloadBtn.addEventListener('click', () => {
    if (!currentImage) {
        alert('请先上传图片并添加水印');
        return;
    }
    
    canvas.toBlob((blob) => {
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.download = 'watermarked_image.png';
        link.href = url;
        link.click();
        URL.revokeObjectURL(url); // 释放内存
    }, 'image/png');
});
    </script>  
  </body>
</html>